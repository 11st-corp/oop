# 6. 객체 지도

> 유일하게 변하지 않는 것은 모든 것이 변한다는 사실뿐이다. - 헤라클레이토스
> 
- 기능이 아니라 구조를 기반으로 모델을 구축하는 편이 좀 더 범용적이고 이해하기 쉬우며 변경에 안정적이다.
    - 지나가는 행인에게 길 묻기(기능적, 해결지향적) vs 지도 보기(구조적, 문제 지향적)

### **기능 설계 대 구조 설계**

- 모든 소프트웨어 제품의 설계에는 두 가지 측면이 존재한다.
    - 기능
        - 제품이 사용자를 위해 무엇을 할 수 있는지
    - 구조
        - 제품의 형태가 어떠해야 하는지
- 성공적인 소프트웨어의 공통적 특징 (훌륭한 설계자 특징)
    - 훌륭한 기능 제공 + 새로운 기능(예측 불가능한) 빠르고 안정적으로 추가 가능
- 불확실한 미래의 변경을 예측하고 이를 성급하게 설계에 반영하는 것은 불필요하게 복잡한 설계를 낳을 뿐이다!
- 미래에 대비하는 가장 좋은 방법은 변경을 예측하는 것이 아니라 변경을 수용할 수 있는 선택의 여지를 설계에 마련해 놓는 것이다. (= 좋은 설계)
    - 방법: 자주 변경되는 기능이 아닌 안정적인 구조를 중심으로 설계

### **두 가지 재료: 기능과 구조**

- 유스케이스 모델링: 기능을 수집하고 표현하기 위한 기법
- 도메인 모델링: 구조를 수집하고 표현하기 위한 기법

### **안정적인 재료: 구조**

**도메인 모델**

- 도메인: 사용자가 프로그램을 사용하는 대상 분야
- 모델: 대상을 단순화해서 표현한 것
- 도메인 모델: 소프트웨어가 목적하는 영역 내의 개념과 개념 간의 관계, 다양한 규칙이나 제약 등을 주의 깊게 추상화한 것
- 도메인 모델은 이해관계자들이 바라보는 멘탈 모델이다.
    - 멘탈 모델: 사람들이 자기 자신, 다른 사람, 환경, 자신이 상호작용하는 사물들에 대해 갖는 모형.
- 사용자들은 자신의 멘탈 모델과 유사한 방식으로 제품이 반응하고 움직일 것이라고 기대하기 때문에 훌륭한 디자인이란 사용자가 예상하는 방식에 따라 정확하게 반응하는 제품을 만드는 것이다.

**도메인의 모습을 담을 수 있는 객체지향**

- 애플리케이션은 도메인 모델(사용자들이 도메인을 바라보는 관점)을 기반으로 설계돼야 한다.
- 객체지향을 이용하면 도메인에 대한 사용자 모델, 디자인 모델, 시스템 이미지 모두가 유사한 모습을 유지하도록 만드는 것이 가능하다.
    - 객체지향의 이러한 특징을 연결완전성, 표현적 차이라고 한다.

**표현적 차이**

- 소프트웨어 객체는 현실 객체를 모방한 것이 아니라 은유를 기반으로 재창조한 것이다.
    - 소프트웨어 객체 vs 현실 객체 사이의 의미적 거리 : 표현적 차이 or 의미적 차이
- 핵심은 은유를 통해 현실 객체와 소프트웨어 객체의 차이를 최대한 줄이는 것.
- 은유를 통해 투영해야 하는 대상은?
    - 사용자가 도메인에 대해 생각하는 개념들 → 도메인 모델
    - 이것이 도메인 모델이 중요한 이유
- 도메인 모델을 기반으로 설계, 구현 → 사용자가 도메인을 보는 관점을 그대로 코드에 반영 → 표현적 차이 줄어들 것

**불안정한 기능을 담는 안정적인 도메인 모델**

- 도메인 모델을 기반으로 코드를 작성하는 두 번째 이유: 구조가 상대적으로 안정적
- 도메인에 대한 사용자의 관점(=도메인 모델)을 반영해야 하는 이유
    - 사용자들이 누구보다도 도메인의 ‘본질적인’ 측면을 가장 잘 이해하고 있기 때문
- 본질적이라는 것은 변경이 적고 비교적 그 특성이 오랜 시간 유지된다는 것을 의미.
- 사용자 모델에 포함된 개념과 규칙은 비교적 변경될 확률이 적다.

### 불안정한 재료: 기능

**유스케이스**

- 기능적 요구사항: 시스템이 사용자에게 제공해야 하는 기능의 목록
- 시스템이 사용자에게 기능을 제공하는 이유?
    - 사용자들이 시스템을 통해 달성하고자 하는 ‘목표’가 있기 때문
- 목표를 가진 사용자와 시스템 간의 ‘상호작용’ 관점에서 시스템을 바라봐야 한다.
- 유스케이스: 사용자의 목표를 달성하기 위해 사용자와 시스템 간에 이뤄지는 상호작용의 흐름을 텍스트로 정리한 것
- 유스케이스의 가치: 사용자들의 목표를 중심으로 시스템의 기능적인 요구사항들을 이야기 형식으로 묶을 수 있다는 점
    - 정신적 과부하를 줄임

**유스케이스의 특성**

1. 유스케이스는 사용자와 시스템 간의 상호작용을 보여주는 텍스트다.
    - 유스케이스의 핵심은 사용자와 시스템 간의 상호작용을 일련의 이야기 흐름으로 표현하는 것.
2. 유스케이스는 하나의 시나리오가 아니라 여러 시나리오들의 집합이다.
    - 시나리오를 유스케이스 인스턴스라고도 한다.
3. 유스케이스는 단순한 피처 목록과 다르다.
    - 이야기를 통해 연관된 기능을 함께 묶을 수 있다.
4. 유스케이스는 사용자 인터페이스와 관련된 세부 정보를 포함하지 말아야 한다.
    - 유스케이스는 자주 변경되는 사용자 인터페이스 요소는 배제하고 사용자 관점에서 시스템의 행위에 초점을 맞춘다. → 본질적인 유스케이스 형식
5. 유스케이스는 내부 설계와 관련된 정보를 포함하지 않는다.

**유스케이스는 설계 기법도, 객체지향 기법도 아니다**

- 유스케이스가 단지 사용자가 바라보는 시스템의 외부 관점만을 표현한다는 점에 주목하라.
- 내부 구조, 실행 메커니즘에 관한 어떤 정보도 제공하지 않는다.
- 유스케이스와 객체의 구조 사이에는 커다란 간격이 존재한다.

### 재료 합치기: 기능과 구조의 통합

**도메인 모델, 유스케이스, 그리고 책임-주도 설계**

- 변경에 유연한 소프트웨어
    - 유스케이스에 정리된 시스템의 기능을 도메인 모델을 기반으로 한 객체들의 책임으로 분배해야 함
- 설계 흐름
    - 시스템은 자신이 전송한 메시지에 응답하는 데 필요한 책임을 수행하는 일종의 객체
    - 시스템의 커다란 규모의 책임은 더 작은 크기의 객체들의 협력을 통해 구현될 수 있다.
    - 첫 번째 메시지는 시스템의 기능을 시스템의 책임으로 바꾼 후 얻어진 것(책임-주도 설계는 이 지점부터 작용 : 객체들 간의 주고받는 메시지를 기반으로 적절한 역할과 책임, 협력을 발견하는 것)
    - 어떤 객체를 선택할 것인가? (도메인 모델 등장 - 안정적인 구조)
        - 도메인 모델에 포함된 개념을 은유하는 소프트웨어 객체를 선택해야 함
    - 메시지를 식별하면서 객체들에게 책임 할당해나감
    - 협력에 참여하는 객체를 구현하기 위해 클래스, 속성, 메서드 구현 → 시스템 기능 완성
    - 불안정한 기능을 수행할 수 있는 안정적인 구조 탄생
- 유스케이스에서 출발해 객체들의 협력으로 이어지는 일련의 흐름은 객체 안에 다른 객체를 포함하는 재귀적 합성이라는 객체지향의 기본 개념을 잘 보여준다.

**기능 변경을 흡수하는 안정적인 구조**

- 도메인 모델을 구성하는 개념은 비즈니스가 없어지거나 완전히 개편되지 않는 한 안정적으로 유지된다.
    - 정기예금 도메인 - 정기예금, 계좌, 이자율, 이자
- 도메인 모델을 구성하는 개념간의 관계는 비즈니스 규칙을 기반으로 하기 때문에 안정적으로 유지된다.
- 객체지향의 가장 큰 장점: 도메인을 모델링하기 위한 기법과 도메인을 프로그래밍하기 위해 사용하는 기법이 동일하다는 점. → 연결완전성
- 코드의 변경으로부터 도메인 모델의 변경 사항을 유추할 수 있다. → 가역성

**결론**

- 안정적인 도메인 모델을 기반으로 시스템의 기능을 구현하라.
- 도메인 모델과 코드를 연관시키기 위해 노력하라.
- 그것이 유지보수하기 쉽고 유연한 객체지향 시스템을 만드는 첫걸음이 될 것이다.
